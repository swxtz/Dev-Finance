import { PrismaService } from "@/prisma/prisma.service";
import { generateCode } from "@/utils/utils.";
import { Injectable } from "@nestjs/common";
import { Resend } from "resend";

@Injectable()
export class EmailsService {
    constructor(private prisma: PrismaService) {}

    async sendAccountVerificationEmail() {
        const resend = new Resend("re_hbcaSuzW_Dqac7r5zEt1ULVGshKG7VCwM");

        const code = generateCode();
        const name = "Gustavo";
        const link = `http://localhost:3000/verify?code=${code}`;

        const { data, error } = await resend.emails.send({
            from: "Acme <onboarding@resend.dev>",
            to: ["dev.gustavomendonca@protonmail.com"],
            subject: "Verify your email address",
            html: `<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
            <html class="bg-zinc-600" dir="ltr" lang="pt-br">
            
              <head>
                <meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />
              </head>
              <div style="display:none;overflow:hidden;line-height:1px;opacity:0;max-height:0;max-width:0">Codigo de Verificação<div> ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌</div>
              </div>
            
              <body style="background-color:rgb(10,10,10);color:rgb(234,234,234);margin-top:200px;margin-bottom:200px">
                <table align="center" width="100%" border="0" cellPadding="0" cellSpacing="0" role="presentation" style="max-width:465px;border-color:rgb(234,234,234);border-radius:0.25rem;margin-top:40px;margin-bottom:40px;margin-left:auto;margin-right:auto;padding:20px">
                  <tbody>
                    <tr style="width:100%">
                      <td>
                        <table align="center" width="100%" border="0" cellPadding="0" cellSpacing="0" role="presentation" style="margin-top:32px">
                          <tbody>
                            <tr>
                              <td><svg style="display:block;outline:none;border:none;text-decoration:none;margin-top:0px;margin-bottom:0px;margin-left:auto;margin-right:auto" width="222" height="28" viewBox="0 0 222 28" fill="none" xmlns="http://www.w3.org/2000/svg">
                              <path d="M65.7339 26.931C65.0391 26.931 64.4563 26.689 63.9856 26.205C63.5149 25.721 63.2796 25.1218 63.2796 24.4073C63.2796 23.6929 63.5149 23.0936 63.9856 22.6097C64.4563 22.1257 65.0391 21.8837 65.7339 21.8837C66.4063 21.8837 66.9779 22.1257 67.4486 22.6097C67.9193 23.0936 68.1546 23.6929 68.1546 24.4073C68.1546 25.1218 67.9193 25.721 67.4486 26.205C66.9779 26.689 66.4063 26.931 65.7339 26.931Z" fill="#062D15"/>
                              <path d="M0 17.078C0 15.1651 0.381037 13.4711 1.14311 11.9961C1.9276 10.521 2.98106 9.38021 4.30348 8.57356C5.64832 7.74386 7.13885 7.32901 8.77507 7.32901C9.98542 7.32901 11.1734 7.60558 12.3389 8.15871C13.5268 8.68879 14.4682 9.40326 15.163 10.3021V1.10627H19.0295V26.6887H15.163V23.8193C14.5355 24.7412 13.6613 25.5017 12.5406 26.101C11.4423 26.7002 10.1759 26.9998 8.74145 26.9998C7.12764 26.9998 5.64832 26.5849 4.30348 25.7552C2.98106 24.9025 1.9276 23.7271 1.14311 22.229C0.381037 20.7079 0 18.9909 0 17.078ZM15.163 17.1471C15.163 15.8334 14.8941 14.6926 14.3561 13.7246C13.8406 12.7566 13.157 12.0191 12.3053 11.5121C11.4535 11.005 10.5346 10.7515 9.54835 10.7515C8.56213 10.7515 7.64316 11.005 6.79143 11.5121C5.9397 11.9961 5.24487 12.7221 4.70693 13.69C4.19141 14.635 3.93365 15.7643 3.93365 17.078C3.93365 18.3917 4.19141 19.544 4.70693 20.5351C5.24487 21.5261 5.9397 22.2866 6.79143 22.8167C7.66558 23.3238 8.58455 23.5773 9.54835 23.5773C10.5346 23.5773 11.4535 23.3238 12.3053 22.8167C13.157 22.3097 13.8406 21.5722 14.3561 20.6042C14.8941 19.6132 15.163 18.4608 15.163 17.1471Z" fill="#E5E7EB"/>
                              <path d="M41.0422 16.6977C41.0422 17.4122 40.9974 18.0575 40.9078 18.6337H26.7533C26.8654 20.1548 27.4146 21.3763 28.4008 22.2982C29.387 23.2201 30.5973 23.681 32.0318 23.681C34.0939 23.681 35.5508 22.7937 36.4025 21.019H40.5379C39.9776 22.7706 38.9577 24.2111 37.4784 25.3404C36.0215 26.4467 34.206 26.9998 32.0318 26.9998C30.2611 26.9998 28.6697 26.5965 27.2577 25.7898C25.868 24.9601 24.7697 23.8078 23.9628 22.3327C23.1783 20.8347 22.7861 19.1061 22.7861 17.1471C22.7861 15.1881 23.1671 13.4711 23.9292 11.9961C24.7137 10.498 25.8007 9.34564 27.1904 8.53899C28.6025 7.73233 30.2163 7.32901 32.0318 7.32901C33.7801 7.32901 35.3379 7.72081 36.7051 8.50442C38.0724 9.28802 39.1371 10.3943 39.8991 11.8232C40.6612 13.2291 41.0422 14.8539 41.0422 16.6977ZM37.0413 15.4531C37.0189 14.0012 36.5146 12.8373 35.5284 11.9615C34.5422 11.0857 33.3206 10.6478 31.8637 10.6478C30.5413 10.6478 29.4094 11.0857 28.468 11.9615C27.5266 12.8142 26.9663 13.9781 26.787 15.4531H37.0413Z" fill="#E5E7EB"/>
                              <path d="M51.9753 23.1624L57.2202 7.64015H61.2883L54.228 26.6887H49.6555L42.6287 7.64015H46.7305L51.9753 23.1624Z" fill="#E5E7EB"/>
                              <path d="M65.7321 26.9307C65.0373 26.9307 64.4545 26.6887 63.9838 26.2047C63.5131 25.7207 63.2778 25.1214 63.2778 24.407C63.2778 23.6925 63.5131 23.0933 63.9838 22.6093C64.4545 22.1253 65.0373 21.8833 65.7321 21.8833C66.4045 21.8833 66.9761 22.1253 67.4468 22.6093C67.9175 23.0933 68.1528 23.6925 68.1528 24.407C68.1528 25.1214 67.9175 25.7207 67.4468 26.2047C66.9761 26.6887 66.4045 26.9307 65.7321 26.9307Z" fill="#E5E7EB"/>
                              <path d="M80.0617 10.8552H76.6324V26.6887H72.766V10.8552H70.5806V7.64015H72.766V6.29188C72.766 4.1024 73.3263 2.51214 74.447 1.52111C75.5901 0.507038 77.372 0 79.7927 0V3.28422C78.6272 3.28422 77.8091 3.5147 77.3384 3.97564C76.8677 4.41354 76.6324 5.18562 76.6324 6.29188V7.64015H80.0617V10.8552Z" fill="#E5E7EB"/>
                              <path d="M85.4085 5.11648C84.7137 5.11648 84.1309 4.87448 83.6602 4.39049C83.1895 3.9065 82.9542 3.30727 82.9542 2.59281C82.9542 1.87835 83.1895 1.27912 83.6602 0.795128C84.1309 0.311137 84.7137 0.0691407 85.4085 0.0691407C86.0809 0.0691407 86.6525 0.311137 87.1232 0.795128C87.5938 1.27912 87.8292 1.87835 87.8292 2.59281C87.8292 3.30727 87.5938 3.9065 87.1232 4.39049C86.6525 4.87448 86.0809 5.11648 85.4085 5.11648ZM87.2913 7.64015V26.6887H83.4585V7.64015H87.2913Z" fill="#E5E7EB"/>
                              <path d="M101.67 7.32901C103.127 7.32901 104.427 7.64015 105.57 8.26242C106.736 8.88469 107.643 9.80658 108.293 11.0281C108.943 12.2496 109.268 13.7246 109.268 15.4531V26.6887H105.469V16.0408C105.469 14.3354 105.054 13.0332 104.225 12.1343C103.396 11.2125 102.264 10.7515 100.829 10.7515C99.395 10.7515 98.2519 11.2125 97.4001 12.1343C96.5708 13.0332 96.1562 14.3354 96.1562 16.0408V26.6887H92.3234V7.64015H96.1562V9.81811C96.7837 9.0345 97.5794 8.42375 98.5432 7.98585C99.5295 7.54796 100.572 7.32901 101.67 7.32901Z" fill="#E5E7EB"/>
                              <path d="M112.88 17.078C112.88 15.1651 113.261 13.4711 114.023 11.9961C114.807 10.521 115.861 9.38021 117.183 8.57356C118.528 7.74386 120.007 7.32901 121.621 7.32901C123.078 7.32901 124.344 7.62862 125.42 8.22785C126.519 8.80403 127.393 9.53002 128.043 10.4058V7.64015H131.909V26.6887H128.043V23.8538C127.393 24.7527 126.507 25.5017 125.387 26.101C124.266 26.7002 122.988 26.9998 121.554 26.9998C119.962 26.9998 118.506 26.5849 117.183 25.7552C115.861 24.9025 114.807 23.7271 114.023 22.229C113.261 20.7079 112.88 18.9909 112.88 17.078ZM128.043 17.1471C128.043 15.8334 127.774 14.6926 127.236 13.7246C126.72 12.7566 126.037 12.0191 125.185 11.5121C124.333 11.005 123.414 10.7515 122.428 10.7515C121.442 10.7515 120.523 11.005 119.671 11.5121C118.819 11.9961 118.125 12.7221 117.587 13.69C117.071 14.635 116.813 15.7643 116.813 17.078C116.813 18.3917 117.071 19.544 117.587 20.5351C118.125 21.5261 118.819 22.2866 119.671 22.8167C120.545 23.3238 121.464 23.5773 122.428 23.5773C123.414 23.5773 124.333 23.3238 125.185 22.8167C126.037 22.3097 126.72 21.5722 127.236 20.6042C127.774 19.6132 128.043 18.4608 128.043 17.1471Z" fill="#E5E7EB"/>
                              <path d="M146.29 7.32901C147.747 7.32901 149.047 7.64015 150.19 8.26242C151.356 8.88469 152.263 9.80658 152.913 11.0281C153.563 12.2496 153.888 13.7246 153.888 15.4531V26.6887H150.089V16.0408C150.089 14.3354 149.674 13.0332 148.845 12.1343C148.016 11.2125 146.884 10.7515 145.449 10.7515C144.015 10.7515 142.872 11.2125 142.02 12.1343C141.191 13.0332 140.776 14.3354 140.776 16.0408V26.6887H136.943V7.64015H140.776V9.81811C141.404 9.0345 142.199 8.42375 143.163 7.98585C144.149 7.54796 145.192 7.32901 146.29 7.32901Z" fill="#E5E7EB"/>
                              <path d="M157.5 17.1471C157.5 15.1881 157.881 13.4711 158.643 11.9961C159.427 10.498 160.503 9.34564 161.87 8.53899C163.238 7.73233 164.807 7.32901 166.577 7.32901C168.819 7.32901 170.668 7.88214 172.125 8.98841C173.604 10.0716 174.602 11.6273 175.117 13.6555H170.982C170.645 12.7105 170.108 11.973 169.368 11.4429C168.628 10.9128 167.698 10.6478 166.577 10.6478C165.008 10.6478 163.753 11.224 162.812 12.3763C161.893 13.5057 161.433 15.0959 161.433 17.1471C161.433 19.1983 161.893 20.8001 162.812 21.9525C163.753 23.1048 165.008 23.681 166.577 23.681C168.796 23.681 170.264 22.6784 170.982 20.6733H175.117C174.579 22.6093 173.57 24.1535 172.091 25.3058C170.612 26.4351 168.774 26.9998 166.577 26.9998C164.807 26.9998 163.238 26.5965 161.87 25.7898C160.503 24.9601 159.427 23.8078 158.643 22.3327C157.881 20.8347 157.5 19.1061 157.5 17.1471Z" fill="#E5E7EB"/>
                              <path d="M195.915 16.6977C195.915 17.4122 195.87 18.0575 195.781 18.6337H181.626C181.738 20.1548 182.288 21.3763 183.274 22.2982C184.26 23.2201 185.47 23.681 186.905 23.681C188.967 23.681 190.424 22.7937 191.276 21.019H195.411C194.851 22.7706 193.831 24.2111 192.351 25.3404C190.895 26.4467 189.079 26.9998 186.905 26.9998C185.134 26.9998 183.543 26.5965 182.131 25.7898C180.741 24.9601 179.643 23.8078 178.836 22.3327C178.051 20.8347 177.659 19.1061 177.659 17.1471C177.659 15.1881 178.04 13.4711 178.802 11.9961C179.587 10.498 180.674 9.34564 182.063 8.53899C183.476 7.73233 185.089 7.32901 186.905 7.32901C188.653 7.32901 190.211 7.72081 191.578 8.50442C192.945 9.28802 194.01 10.3943 194.772 11.8232C195.534 13.2291 195.915 14.8539 195.915 16.6977ZM191.914 15.4531C191.892 14.0012 191.388 12.8373 190.401 11.9615C189.415 11.0857 188.194 10.6478 186.737 10.6478C185.414 10.6478 184.282 11.0857 183.341 11.9615C182.4 12.8142 181.839 13.9781 181.66 15.4531H191.914Z" fill="#E5E7EB"/>
                              <path d="M221.423 19.656C221.423 20.6319 221.14 21.5492 220.575 22.408C220.032 23.2668 219.217 23.9889 218.132 24.5745C217.068 25.16 215.801 25.5113 214.331 25.6284V27.9998H212.125V25.6284C209.999 25.4527 208.28 24.877 206.968 23.9011C205.656 22.9252 205 21.637 205 20.0366H209.139C209.207 20.7978 209.49 21.4321 209.988 21.9396C210.485 22.4275 211.198 22.7398 212.125 22.8764V16.4356C210.61 16.1038 209.377 15.772 208.427 15.4402C207.477 15.0889 206.662 14.5424 205.984 13.8007C205.328 13.059 205 12.0441 205 10.756C205 9.136 205.656 7.79904 206.968 6.74509C208.28 5.67162 209.999 5.04705 212.125 4.87139V2.5H214.331V4.87139C216.322 5.02753 217.917 5.57403 219.116 6.51088C220.337 7.42821 221.027 8.69685 221.185 10.3168H217.046C216.978 9.71177 216.706 9.17503 216.231 8.70661C215.756 8.21867 215.123 7.88687 214.331 7.71121V14.0349C215.847 14.3472 217.08 14.679 218.03 15.0303C218.98 15.3621 219.783 15.8989 220.439 16.6405C221.095 17.3627 221.423 18.3678 221.423 19.656ZM208.936 10.5803C208.936 11.3805 209.207 12.0051 209.75 12.454C210.316 12.9029 211.107 13.264 212.125 13.5372V7.62338C211.153 7.72097 210.372 8.02349 209.784 8.53095C209.219 9.03841 208.936 9.72153 208.936 10.5803ZM214.331 22.8764C215.326 22.7398 216.107 22.3982 216.672 21.8517C217.238 21.2857 217.521 20.6124 217.521 19.8317C217.521 19.051 217.238 18.4459 216.672 18.0165C216.129 17.5676 215.349 17.2065 214.331 16.9333V22.8764Z" fill="#127D3B"/>
                              </svg>
                              </td>
                            </tr>
                          </tbody>
                        </table>
                        <h1 class="" style="color:rgb(234,234,234);font-size:24px;font-weight:400;text-align:center;padding:0px;margin-top:30px;margin-bottom:30px;margin-left:0px;margin-right:0px">Bem-vindo ao <strong>dev.finance</strong></h1>
                        <p style="font-size:24px;line-height:24px;margin:16px 0;color:rgb(234,234,234)">Olá <strong>${name}</strong>, obrigado por criar sua conta.</p>
                        <p style="font-size:16px;line-height:24px;margin:16px 0;color:rgb(234,234,234)">Você está a um passo de organizar sua vida financeira, para continuar, por favor, confirme seu e-mail.</p>
                        <p style="font-size:28px;line-height:24px;margin:16px 0;margin-top:48px"><strong>Seu Codígo de Verificação:</strong></p>
                        <p style="font-size:14px;line-height:24px;margin:16px 0;margin-top:48px;text-align:center;text-transform:uppercase;letter-spacing:.30em"><strong style="padding-top:1rem;padding-bottom:1rem;padding-left:2rem;padding-right:2rem;font-size:28px;border-width:1px;border-style:solid;border-color:rgb(234,234,234)">${code}</strong></p>
                        <table align="center" width="100%" border="0" cellPadding="0" cellSpacing="0" role="presentation" style="max-width:37.5em;margin-top:1rem;text-align:center">
                          <tbody>
                            <tr style="width:100%">
                              <td>
                                <p style="font-size:16px;line-height:24px;margin:16px 0;margin-top:1rem;color:rgb(234,234,234)">Ou se preferir, clique no botão abaixo para confirmar</p><a href="${link}" style="background-color:rgb(6,45,21);margin-left:auto;margin-right:auto;border-radius:0.25rem;color:rgb(255,255,255);font-size:16px;font-weight:600;text-decoration-line:none;text-align:center;padding-left:1.25rem;padding-right:1.25rem;padding-top:0.75rem;padding-bottom:0.75rem;line-height:100%;text-decoration:none;display:inline-block;max-width:100%;padding:12px 20px 12px 20px" target="_blank"><span><!--[if mso]><i style="letter-spacing: 20px;mso-font-width:-100%;mso-text-raise:18" hidden>&nbsp;</i><![endif]--></span><span style="max-width:100%;display:inline-block;line-height:120%;mso-padding-alt:0px;mso-text-raise:9px">Verificar Conta</span><span><!--[if mso]><i style="letter-spacing: 20px;mso-font-width:-100%" hidden>&nbsp;</i><![endif]--></span></a>
                              </td>
                            </tr>
                          </tbody>
                        </table>
                        <table align="center" width="100%" border="0" cellPadding="0" cellSpacing="0" role="presentation" style="margin-top:80px;border-top-width:1px;border-style:solid;border-color:rgb(113,113,122)">
                          <tbody>
                            <tr>
                              <td>
                                <p style="font-size:16px;line-height:24px;margin:16px 0;margin-top:2rem;color:rgb(156,163,175);text-align:center">Todos os direitos reservados © dev.finance$ 2024.</p>
                              </td>
                            </tr>
                          </tbody>
                        </table>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </body>
            
            </html>`,
        });
        if (error) {
            return console.error({ error });
        }
        console.log({ data });
        return { message: "Email enviado com sucesso" };
    }
}
